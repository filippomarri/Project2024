<html>
    <head></head>
    <body>
        <div id="container">

            <h1>What is the sound of colours?</h1>

            <label for="imageInput" id="imageInputLabel">Upload Image</label>
            <input type="file" id="imageInput" accept="image/*">

            <canvas id="myCanvas"></canvas>
            <button id="toggleButton">Start Animation</button>
            <input type="range" id="speedSlider" min="1" max="15" value="1">


            
        </div>

        <style>

            h1 {
                margin: 0;
                padding: 10px 0;
                text-align: center;
                color: white;
            }

            body {
                background-color: black;
                text-align: center;
                background-image: url('psychedelic-swirl-trippy-background-cqe4l5nuaryzu32g.jpg');
                background-size: cover; /* This will cover the entire viewport */
                background-position: center; /* Center the background image */
                background-repeat: no-repeat; /* Do not repeat the background image */
            }

            canvas {
                padding-left: 0;
                padding-right: 0;
                margin-left: auto;
                margin-right: auto;
                display: block;
                background-color: black;
            }

            #toggleButton,
            #imageInputLabel,
            h1 {
                font-family: 'Arial', sans-serif; /* Set the same font for both elements */
            }


            #toggleButton {
                padding: 10px;
                font-size: 16px;
                background-color: white;
                color: black;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                margin-top: 10px;
            }

            #imageInput {
                display: none; /* Hide the default file input */
                padding: 10px;
                margin-top: 10px;
                background-color: white;
                color: black;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                margin-bottom: 10px;
            }

            #imageInputLabel {
                display: inline-block;
                background-color: white;
                color: black;
                padding: 10px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                margin-bottom: 10px;
            }

            #speedSlider {
                width: 100%;
                margin-top: 10px;
                transform: rotate(-90deg);
                transform-origin: bottom left;
                appearance: none;
                background: #ddd;
                outline: none;
                opacity: 0.7;
                transition: opacity 0.2s;
            }
        </style>

        <script>
            // Get the canvas and context
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');

            // Input element for uploading background image
            const imageInput = document.getElementById('imageInput');

            // Animation variables
            let animationId;
            let isAnimating = false;
            let x = 0; // Initial position
            let speed = 0.5; // Initial speed
            let backgroundImage;

            // Function to upload the image in the canvas
            imageInput.addEventListener('change', handleImageUpload);

            function handleImageUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        backgroundImage = new Image();
                        backgroundImage.src = e.target.result;
                        backgroundImage.onload = function () {
                            resizeCanvas(); // Adjust the canvas size when a new image is loaded
                        };
                    };
                    reader.readAsDataURL(file);
                }
            }

            // Function to animate the line
            function animateLine() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Draw the background image with margins if necessary
                if (backgroundImage) {
                    const maxImageWidth = canvas.width; // Adjust the margin as needed
                    const maxImageHeight = canvas.height; // Adjust the margin as needed

                    const aspectRatio = backgroundImage.width / backgroundImage.height;

                    let imgWidth = maxImageWidth;
                    let imgHeight = imgWidth / aspectRatio;

                    if (imgHeight > maxImageHeight) {
                        imgHeight = maxImageHeight;
                        imgWidth = imgHeight * aspectRatio;
                    }

                    const xPosition = (canvas.width - imgWidth) / 2;
                    const yPosition = (canvas.height - imgHeight) / 2;

                    ctx.drawImage(backgroundImage, xPosition, yPosition, imgWidth, imgHeight);

                    //  QUESTO NON FUNZIONA NON SO PERCHÃ©
                    // x = (canvas.width - imgWidth) / 2;

                    // Draw a moving line within the image borders
                    ctx.beginPath();
                    ctx.moveTo(x, (canvas.height - imgHeight) / 2);
                    const lineHeight = imgHeight;
                    ctx.lineTo(x, (canvas.height - imgHeight) / 2 + lineHeight);
                    ctx.strokeStyle = 'blue';
                    ctx.lineWidth = 5;
                    ctx.stroke();
                    ctx.closePath();

                    // Update the position for the next frame
                    x += speed;

                    // Check if the line has reached the right border of the image
                    if (x > (canvas.width + imgWidth) / 2) {
                        x = (canvas.width - imgWidth) / 2; // Return to the left side of the image
                        isAnimating = false;
                        toggleButton.textContent = 'Start Animation';
                    }

                    // Request the next animation frame
                    if (isAnimating) {
                        animationId = requestAnimationFrame(animateLine);
                    }
                } else { // If the image is not loaded

                    // Draw a moving line
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    const lineHeight = canvas.height;
                    ctx.lineTo(x, lineHeight);

                    ctx.strokeStyle = 'blue';
                    ctx.lineWidth = 5;
                    ctx.stroke();
                    ctx.closePath();

                    // Update the position for the next frame
                    x += speed;

                    // Check if the line has reached the right border
                    if (x > canvas.width) {
                        x = 0; // Return to the left side
                        isAnimating = false;
                        toggleButton.textContent = 'Start Animation';
                    }

                    // Request the next animation frame
                    if (isAnimating) {
                        animationId = requestAnimationFrame(animateLine);
                    }
                }
            }

            // Toggle button
            const toggleButton = document.getElementById('toggleButton');
            toggleButton.addEventListener('click', () => {
                if (!isAnimating) {
                    // Start the animation
                    isAnimating = true;
                    toggleButton.textContent = 'Stop Animation';
                    animateLine();
                } else {
                    // Stop the animation
                    cancelAnimationFrame(animationId);
                    isAnimating = false;
                    toggleButton.textContent = 'Start Animation';
                }
            });

            // Speed slider
            const speedSlider = document.getElementById('speedSlider');
            speedSlider.addEventListener('input', (event) => {
                speed = parseInt(event.target.value, 10)*0.5;
            });

            // Resize canvas when the window is resized
            function resizeCanvas() {
                canvas.width = window.innerWidth - 300;
                canvas.height = window.innerHeight - 200;
                drawCanvas();
            }

            function drawCanvas() {
                // Redraw the background image and any other elements here
                if (backgroundImage) {
                    const maxImageWidth = canvas.width; // Adjust the margin as needed
                    const maxImageHeight = canvas.height; // Adjust the margin as needed

                    const aspectRatio = backgroundImage.width / backgroundImage.height;

                    let imgWidth = maxImageWidth;
                    let imgHeight = imgWidth / aspectRatio;

                    if (imgHeight > maxImageHeight) {
                        imgHeight = maxImageHeight;
                        imgWidth = imgHeight * aspectRatio;
                    }

                    const xPosition = (canvas.width - imgWidth) / 2;
                    const yPosition = (canvas.height - imgHeight) / 2;

                    ctx.drawImage(backgroundImage, xPosition, yPosition, imgWidth, imgHeight);

                    // Start from the image left border
                    x = (canvas.width - imgWidth) / 2;
                }
            }

            window.addEventListener('resize', resizeCanvas);

            // Initial canvas setup
            resizeCanvas();

            // prova prova prova


        </script>
    </body>
</html>