<html>
    <head></head>
    <body>
        <div id="container">

            <h1 onclick="moveTitle()">What is the sound of colours?</h1>

            <canvas id="myCanvas"></canvas>

            <label for="imageInput" id="imageInputLabel">Upload Image</label>
            <input type="file" id="imageInput" accept="image/*">

            <button id="toggleButton">Start Animation</button>

            <input type="range" id="speedSlider" orient='vertical' min="1" max="15" value="1">


            
        </div>

        <style>

            body {
                background-color: black;
            }

            h1 {
                color: white;
                cursor: pointer;
                transition: transform 2.5s ease-in-out;
                margin: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 0;
                text-align: center;
                font-family: sans-serif;
                font-size: 3rem;
                letter-spacing: 0.15rem;
                /*text-transform: uppercase;*/
                color: #fff;
                text-shadow: -4px 4px #ef3550,
                            -8px 8px #f48fb1,
                            -12px 12px #7e57c2,
                            -16px 16px #2196f3,
                            -20px 20px #26c6da,
                            -24px 24px #43a047,
                            -28px 28px #eeff41,
                            -32px 32px #f9a825,
                            -36px 36px #ff5722;
            }

            canvas {
                padding-left: 0;
                padding-right: 0;
                margin-left: auto;
                margin-right: auto;
                display: block;
                background-color: black;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: -1;
            }

            #toggleButton,
            #imageInputLabel,
            h1 {
                font-family: 'Arial', sans-serif; /* Set the same font for both elements */
            }


            #toggleButton {
                padding: 10px;
                font-size: 16px;
                background-color: white;
                color: black;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                margin-top: 10px;
            }

            #imageInput {
                display: none; /* Hide the default file input */
                padding: 10px;
                margin-top: 10px;
                background-color: white;
                color: black;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                margin-bottom: 10px;
            }

            #imageInputLabel {
                display: inline-block;
                background-color: white;
                color: black;
                padding: 10px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                margin-bottom: 10px;
            }

            #speedSlider {
                -webkit-appearance: none;
                width: 8px;
                height: 100vh; /* Set height to the full window height */
                position: fixed;
                right: 20px; /* Position on the right side */
                top: 0; /* Position at the top */
                background: #d3d3d3;
                outline: none;
                opacity: 0.7;
                -webkit-transition: .2s;
                transition: opacity .2s;
            }

            #speedSlider:hover {
                opacity: 1;
            }

            #speedSlider::-webkit-slider-thumb {
                -webkit-appearance: none;
                width: 16px;
                height: 16px;
                background: #4CAF50;
                cursor: pointer;
            }

            #speedSlider::-moz-range-thumb {
                width: 16px;
                height: 16px;
                background: #4CAF50;
                cursor: pointer;
            }

        </style>

        <script>
            // Get the canvas and context
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');

            // Input element for uploading background image
            const imageInput = document.getElementById('imageInput');

            let hasMoved = false;

            function moveTitle() {
                if (!hasMoved) {
                    const title = document.querySelector('h1');
                    const currentPosition = title.getBoundingClientRect();
                    const newPosition = - currentPosition.bottom + 50;

                    title.style.transform = `translateY(${newPosition}px)`;
                    hasMoved = true;
                }
            }

            // Animation variables
            let animationId;
            let isAnimating = false;
            let x = 0; // Initial position
            let speed = 0.5; // Initial speed
            let backgroundImage;

            // Function to upload the image in the canvas
            imageInput.addEventListener('change', handleImageUpload);

            function handleImageUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        backgroundImage = new Image();
                        backgroundImage.src = e.target.result;
                        backgroundImage.onload = function () {
                            resizeCanvas(); // Adjust the canvas size when a new image is loaded
                        };
                    };
                    reader.readAsDataURL(file);
                }
            }

            // Function to animate the line
            function animateLine() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Draw the background image with margins if necessary
                if (backgroundImage) {
                    const maxImageWidth = canvas.width; // Adjust the margin as needed
                    const maxImageHeight = canvas.height; // Adjust the margin as needed

                    const aspectRatio = backgroundImage.width / backgroundImage.height;

                    let imgWidth = maxImageWidth;
                    let imgHeight = imgWidth / aspectRatio;

                    if (imgHeight > maxImageHeight) {
                        imgHeight = maxImageHeight;
                        imgWidth = imgHeight * aspectRatio;
                    }

                    const xPosition = (canvas.width - imgWidth) / 2;
                    const yPosition = (canvas.height - imgHeight) / 2;

                    ctx.drawImage(backgroundImage, xPosition, yPosition, imgWidth, imgHeight);

                    //  QUESTO NON FUNZIONA NON SO PERCHÃ©
                    // x = (canvas.width - imgWidth) / 2;

                    // Draw a moving line within the image borders
                    ctx.beginPath();
                    ctx.moveTo(x, (canvas.height - imgHeight) / 2);
                    const lineHeight = imgHeight;
                    ctx.lineTo(x, (canvas.height - imgHeight) / 2 + lineHeight);
                    ctx.strokeStyle = 'blue';
                    ctx.lineWidth = 5;
                    ctx.stroke();
                    ctx.closePath();

                    // Update the position for the next frame
                    x += speed;

                    // Check if the line has reached the right border of the image
                    if (x > (canvas.width + imgWidth) / 2) {
                        x = (canvas.width - imgWidth) / 2; // Return to the left side of the image
                        isAnimating = false;
                        toggleButton.textContent = 'Start Animation';
                    }

                    // Request the next animation frame
                    if (isAnimating) {
                        animationId = requestAnimationFrame(animateLine);
                    }
                } else { // If the image is not loaded

                    // Draw a moving line
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    const lineHeight = canvas.height;
                    ctx.lineTo(x, lineHeight);

                    ctx.strokeStyle = 'blue';
                    ctx.lineWidth = 5;
                    ctx.stroke();
                    ctx.closePath();

                    // Update the position for the next frame
                    x += speed;

                    // Check if the line has reached the right border
                    if (x > canvas.width) {
                        x = 0; // Return to the left side
                        isAnimating = false;
                        toggleButton.textContent = 'Start Animation';
                    }

                    // Request the next animation frame
                    if (isAnimating) {
                        animationId = requestAnimationFrame(animateLine);
                    }
                }
            }

            // Toggle button
            const toggleButton = document.getElementById('toggleButton');
            toggleButton.addEventListener('click', () => {
                if (!isAnimating) {
                    // Start the animation
                    isAnimating = true;
                    toggleButton.textContent = 'Stop Animation';
                    animateLine();
                } else {
                    // Stop the animation
                    cancelAnimationFrame(animationId);
                    isAnimating = false;
                    toggleButton.textContent = 'Start Animation';
                }
            });

            // Speed slider
            const speedSlider = document.getElementById('speedSlider');
            speedSlider.addEventListener('input', (event) => {
                speed = parseInt(event.target.value, 10)*0.5;
            });

            // Resize canvas when the window is resized
            function resizeCanvas() {
                canvas.width = window.innerWidth - 200;
                canvas.height = window.innerHeight - 200;
                drawCanvas();
            }

            function drawCanvas() {
                // Redraw the background image and any other elements here
                if (backgroundImage) {
                    const maxImageWidth = canvas.width; // Adjust the margin as needed
                    const maxImageHeight = canvas.height; // Adjust the margin as needed

                    const aspectRatio = backgroundImage.width / backgroundImage.height;

                    let imgWidth = maxImageWidth;
                    let imgHeight = imgWidth / aspectRatio;

                    if (imgHeight > maxImageHeight) {
                        imgHeight = maxImageHeight;
                        imgWidth = imgHeight * aspectRatio;
                    }

                    const xPosition = (canvas.width - imgWidth) / 2;
                    const yPosition = (canvas.height - imgHeight) / 2;

                    ctx.drawImage(backgroundImage, xPosition, yPosition, imgWidth, imgHeight);

                    // Start from the image left border
                    x = (canvas.width - imgWidth) / 2;
                }
            }

            window.addEventListener('resize', resizeCanvas);

            // Initial canvas setup
            resizeCanvas();

            // prova prova prova


        </script>
    </body>
</html>